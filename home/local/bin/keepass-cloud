#!/usr/bin/env sh
# This script will launch keepass with a database inside an encrypted dropbox folder.
# This sript will wait untill the db file appears (private folder is mounted) before launching keepass

KEEPASS="$(which keepassx)"
DATABASE="$HOME/sync/password.db"

if [ ! -x "$KEEPASS" ]; then 
    echo "keepassx is not installed, leaving!"
    exit 1
fi

if [ ! -d "$(dirname "$DATABASE")" ]; then
    echo "Dropbox private folder does not exist!"
fi

while [ ! -f "$DATABASE" ]; do
    echo "$DATABASE not found, waiting 10 seconds before checking again!"
    sleep 10
done

echo "$DATABASE found!, launching keepass"
$KEEPASS "$DATABASE" -lock -min
